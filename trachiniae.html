<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Trachiniae – Werkseite</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- ######## START: Werkseite – Trachiniae ######## -->
    <div class="wrap">
      <!-- Kopfzeile -->
      <div class="bar">
        <a class="btn" href="index.html">← Zurück zur Startseite</a>
        <div class="title">Trachiniae <span class="muted">Werkseite</span></div>
      </div>

      <!-- Hinweis -->
      <div class="notice">
        Oben links: <b>texte/Trachiniae.txt</b>. <br />
        Unten separat: <b>texte/Trachiniae_birkenbihl.txt</b>. <br />
        (Beide Dateien gehören in den Ordner <code>texte/</code>.)
      </div>

      <!-- Oben: Grid (links Original, rechts Platzhalter) -->
      <div class="grid">
        <!-- Original (links) -->
        <section class="card">
          <h2>Original – Rohtext</h2>
          <div class="pane-body">
            <div class="split">
              <a class="btn" href="texte/Trachiniae.txt" download
                >Herunterladen</a
              >
            </div>
            <object data="texte/Trachiniae.txt" type="text/plain">
              <pre class="src">
Konnte texte/Trachiniae.txt nicht laden. Liegt die Datei im Ordner texte/?</pre
              >
            </object>
          </div>
        </section>

        <!-- Platzhalter (rechts) -->
        <section class="card">
          <h2>PDF/Extras – Platzhalter</h2>
          <div class="pane-body">
            <p class="muted">
              Hier kommt später die PDF-Ansicht bzw. Werkzeuge (Suche,
              Vers-Sprünge, PDF-Generator usw.). Aktuell bewusst leer gelassen.
            </p>
          </div>
        </section>
      </div>

      <!-- Unten: Birkenbihl-TXT mit Bearbeiten-Modus -->
      <section class="card" style="margin-top: 16px">
        <h2>Birkenbihl – Text</h2>
        <div class="pane-body">
          <div class="split">
            <a class="btn" href="texte/Trachiniae_birkenbihl.txt" download
              >Herunterladen</a
            >
            <button class="btn" id="bb-edit">Bearbeiten</button>
            <button class="btn" id="bb-cancel" style="display: none">
              Abbrechen
            </button>
            <a
              class="btn"
              id="bb-save"
              style="display: none"
              download="Trachiniae_birkenbihl.txt"
              >Geänderte TXT herunterladen</a
            >
          </div>

          <!-- Vorschau (Standard) -->
          <object
            id="bb-view"
            data="texte/Trachiniae_birkenbihl.txt"
            type="text/plain"
          >
            <pre class="src">
Konnte texte/Trachiniae_birkenbihl.txt nicht laden. Liegt die Datei im Ordner texte/?</pre
            >
          </object>

          <!-- Editor (versteckt bis „Bearbeiten“) -->
          <textarea
            id="bb-editor"
            class="src"
            style="
              display: none;
              width: 100%;
              height: calc(70vh - 64px);
              border: 1px solid var(--edge);
              background: #f7f7f7;
            "
          ></textarea>
        </div>
      </section>

      <!-- Quellen -->
      <div class="notice" style="margin-top: 12px">
        Quelle Originaltexte: Perseus Digital Library · Eigene Aufbereitung:
        Birkenbihl/Translinear
      </div>
    </div>
    <!-- ######## ENDE: Werkseite – Trachiniae ######## -->

    <!-- ######## START: Skript – Bearbeiten-Modus ######## -->
    <script>
      (function () {
        const filePath = "texte/Trachiniae_birkenbihl.txt";
        const btnEdit = document.getElementById("bb-edit");
        const btnCancel = document.getElementById("bb-cancel");
        const btnSave = document.getElementById("bb-save");
        const view = document.getElementById("bb-view");
        const editor = document.getElementById("bb-editor");

        async function loadText(path) {
          try {
            const res = await fetch(path);
            if (!res.ok) throw new Error("HTTP " + res.status);
            return await res.text();
          } catch (e) {
            throw new Error("Laden fehlgeschlagen: " + e.message);
          }
        }

        function showEditor(text) {
          editor.value = text;
          view.style.display = "none";
          editor.style.display = "";
          btnEdit.style.display = "none";
          btnCancel.style.display = "";
          btnSave.style.display = "";
        }

        function showView() {
          editor.style.display = "none";
          view.style.display = "";
          btnEdit.style.display = "";
          btnCancel.style.display = "none";
          btnSave.style.display = "none";
        }

        btnEdit?.addEventListener("click", async () => {
          try {
            const txt = await loadText(filePath);
            showEditor(txt);
          } catch (e) {
            alert(
              "Konnte die TXT nicht laden.\nTipp: Seite über http://localhost testen.\n\nFehler: " +
                e.message
            );
          }
        });

        btnCancel?.addEventListener("click", () => {
          showView();
        });

        btnSave?.addEventListener("click", () => {
          const blob = new Blob([editor.value], {
            type: "text/plain;charset=utf-8",
          });
          const url = URL.createObjectURL(blob);
          btnSave.href = url;
          setTimeout(() => URL.revokeObjectURL(url), 30000);
        });
      })();
    </script>
    <!-- ######## ENDE: Skript ######## -->
  </body>
</html>
