<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Trachiniae – Werkseite</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrap">
      <!-- Kopfzeile -->
      <div class="bar">
        <a class="btn" href="index.html">← Zurück zur Startseite</a>
        <div class="title">Trachiniae <span class="muted">Werkseite</span></div>
      </div>

      <!-- Hinweis -->
      <div class="notice">
        Oben links: <b>texte/Trachiniae.txt</b> · Unten: <b>texte/Trachiniae_birkenbihl.txt</b><br />
        PDFs rechts: <b>pdf/TragödieTrachiniae_Normal.pdf</b> und <b>pdf/TragödieTrachiniae_Fett.pdf</b>
      </div>

      <!-- Oben: Grid (links Original, rechts PDF-Links) -->
      <div class="grid">
        <!-- Original (links) -->
        <section class="card">
          <h2>Original – Rohtext</h2>
          <div class="pane-body">
            <div class="split">
              <a class="btn" href="texte/Trachiniae.txt" download>Herunterladen</a>
            </div>
            <object data="texte/Trachiniae.txt" type="text/plain">
              <pre class="src">Konnte texte/Trachiniae.txt nicht laden. Liegt die Datei im Ordner texte/?</pre>
            </object>
          </div>
        </section>

        <!-- PDFs (rechts) -->
        <section class="card">
          <h2>PDF</h2>
          <div class="pane-body">
            <div class="split">
              <a class="btn" href="pdf/TragödieTrachiniae_Normal.pdf" download>PDF Normal</a>
              <a class="btn" href="pdf/TragödieTrachiniae_Fett.pdf" download>PDF Fett</a>
            </div>
            <p class="muted">
              Diese PDFs werden automatisch aus der aktuellen Birkenbihl-Datei gebaut (GitHub-Actions).
            </p>
          </div>
        </section>
      </div>

      <!-- Unten: Birkenbihl-TXT mit Bearbeiten-Modus -->
      <section class="card" style="margin-top: 16px">
        <h2>Birkenbihl – Text</h2>
        <div class="pane-body">
          <div class="split">
            <a class="btn" href="texte/Trachiniae_birkenbihl.txt" download>Herunterladen</a>
            <button class="btn" id="bb-edit">Bearbeiten</button>
            <button class="btn" id="bb-cancel" style="display:none">Abbrechen</button>
            <a class="btn" id="bb-save" style="display:none" download="Trachiniae_birkenbihl.txt">Geänderte TXT herunterladen</a>
          </div>

          <!-- Vorschau -->
          <object id="bb-view" data="texte/Trachiniae_birkenbihl.txt" type="text/plain">
            <pre class="src">Konnte texte/Trachiniae_birkenbihl.txt nicht laden. Liegt die Datei im Ordner texte/?</pre>
          </object>

          <!-- Editor -->
          <textarea id="bb-editor" class="src" style="display:none;width:100%;height:calc(70vh - 64px);border:1px solid var(--edge);background:#f7f7f7;"></textarea>
        </div>
      </section>

      <!-- Quellen -->
      <div class="notice" style="margin-top: 12px">
        Quelle Originaltexte: Perseus Digital Library · Eigene Aufbereitung: Birkenbihl/Translinear
      </div>
    </div>

    <!-- Skript: Bearbeiten/Download -->
    <script>
      (function () {
        const filePath = "texte/Trachiniae_birkenbihl.txt";
        const btnEdit = document.getElementById("bb-edit");
        const btnCancel = document.getElementById("bb-cancel");
        const btnSave = document.getElementById("bb-save");
        const view = document.getElementById("bb-view");
        const editor = document.getElementById("bb-editor");

        async function loadText(path) {
          const res = await fetch(path, { cache: "no-store" });
          if (!res.ok) throw new Error("HTTP " + res.status);
          return await res.text();
        }
        function showEditor(text) {
          editor.value = text;
          view.style.display = "none";
          editor.style.display = "";
          btnEdit.style.display = "none";
          btnCancel.style.display = "";
          btnSave.style.display = "";
        }
        function showView() {
          editor.style.display = "none";
          view.style.display = "";
          btnEdit.style.display = "";
          btnCancel.style.display = "none";
          btnSave.style.display = "none";
        }
        btnEdit?.addEventListener("click", async () => {
          try { showEditor(await loadText(filePath)); }
          catch (e) { alert("Konnte die TXT nicht laden.\nFehler: " + e.message); }
        });
        btnCancel?.addEventListener("click", showView);
        btnSave?.addEventListener("click", () => {
          const blob = new Blob([editor.value], { type: "text/plain;charset=utf-8" });
          const url = URL.createObjectURL(blob);
          btnSave.href = url;
          setTimeout(() => URL.revokeObjectURL(url), 30000);
        });
      })();
    </script>
  </body>
</html>

