<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Birkenbihl / Translinear – Startseite</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .tree {
        background: var(--card);
        border: 1px solid var(--edge);
        border-radius: 0px; /* Eckig statt rund */
        padding: 20px; /* Mehr Abstand zum Inhalt */
        margin: 20px 0;
      }
      h2.language-header {
        font-size: 2.2em; /* Größer für Sprachen */
        margin-top: 20px;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--edge);
        font-weight: bold;
      }
      .node {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 4px;
      }
      .toggle {
        width: 24px;
        text-align: center;
        border: 1px solid var(--edge);
        border-radius: 6px;
        cursor: pointer;
        user-select: none;
        line-height: 18px;
      }
      .label.branch {
        font-weight: 700;
      }
      .label.leaf a {
        text-decoration: underline;
      }
      .children {
        margin-left: 24px;
        padding-left: 8px;
        /* Entfernt: border-left: 1px dashed var(--edge); */
      }
      .toolbar {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }
      .toolbar .btn {
        background: #fff;
      }
      .hint {
        color: var(--muted);
        font-size: 14px;
        margin-top: 6px;
      }
      .notice small {
        color: var(--muted);
      }

      /* NEU: Styles für die Baum-Visualisierung */
      .tree .root {
        padding-left: 0;
      }
      .tree ul {
        list-style-type: none;
        padding-left: 20px;
      }
      .tree li {
        position: relative;
        padding-left: 20px;
        padding-top: 5px;
        padding-bottom: 5px;
      }
      .tree li::before,
      .tree li::after {
        content: "";
        position: absolute;
        left: -12px;
      }
      /* Horizontale Linie */
      .tree li::before {
        border-top: 1px solid var(--edge);
        top: 18px; /* Vertikale Position anpassen */
        width: 15px;
        height: 0;
      }
      /* Vertikale Linie */
      .tree li::after {
        border-left: 1px solid var(--edge);
        height: 100%;
        width: 0px;
        top: -12px; /* Startpunkt anpassen */
      }
      /* Keine vertikale Linie für das letzte Element in einer Liste */
      .tree li:last-child::after {
        height: 30px;
      }
      /* Kleines Quadrat am "Ende" der Linie (vor dem Text) */
      .tree .node::after {
        content: "";
        display: inline-block;
        width: 5px;
        height: 5px;
        background: var(--edge);
        position: absolute;
        left: 3px;
        top: 15px;
      }

      /* Schriftgrößen für verschiedene Ebenen */
      .kind-label {
        font-size: 1.4em; /* Größer für Kategorien (Poesie/Prosa) */
        font-weight: bold;
      }
      .author-label {
        font-size: 1.1em; /* Normal für Autoren */
      }
      .work-label {
        font-size: 1.1em; /* Normal für Werke */
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="bar">
        <div class="title">Birkenbihl / Translinear Übersetzungen</div>
      </div>

      <nav class="tree" aria-label="Werke-Navigation" id="catalogContainer">
        <!-- Der Katalog wird hier dynamisch eingefügt -->
      </nav>
    </div>

    <script type="module">
      import {
        loadCatalog,
        listLanguages,
        listKindsByLanguage,
        listAuthors,
        listWorks,
      } from "./catalog.js";

      function createToggleable(labelText, open = true, cssClass = "") {
        const li = document.createElement("li");
        const node = document.createElement("div");
        node.className = "node";

        const tg = document.createElement("span");
        tg.className = "toggle";
        tg.setAttribute("role", "button");
        tg.setAttribute("aria-expanded", String(open));
        tg.textContent = open ? "–" : "+";

        const label = document.createElement("span");
        label.className = `label branch ${cssClass}`;
        label.textContent = labelText;

        node.appendChild(tg);
        node.appendChild(label);
        li.appendChild(node);

        const ul = document.createElement("ul");
        ul.className = "children";
        if (!open) ul.style.display = "none";
        li.appendChild(ul);

        tg.addEventListener("click", () => {
          const isOpen = tg.getAttribute("aria-expanded") === "true";
          tg.setAttribute("aria-expanded", String(!isOpen));
          tg.textContent = isOpen ? "+" : "–";
          ul.style.display = isOpen ? "none" : "";
        });

        return { li, ul };
      }

      function createLeafLink(text, href) {
        const li = document.createElement("li");
        const node = document.createElement("div");
        node.className = "node";
        const span = document.createElement("span");
        span.className = "label leaf";
        const a = document.createElement("a");
        a.href = href;
        a.textContent = text;
        a.title = "Werkseite öffnen";
        span.appendChild(a);
        node.appendChild(span);
        li.appendChild(node);
        return li;
      }

      (async function init() {
        const container = document.getElementById("catalogContainer");
        const cat = await loadCatalog();

        // Ebene 1: Sprachen
        const languages = listLanguages(cat);
        for (const lang of languages) {
          const header = document.createElement("h2");
          header.className = "language-header";
          header.textContent = lang;
          container.appendChild(header);

          const rootUl = document.createElement("ul");
          rootUl.className = "root";
          container.appendChild(rootUl);

          // Ebene 2: Gattungen (Poesie, Prosa)
          const kinds = listKindsByLanguage(cat, lang);
          for (const kind of kinds) {
            const kindNode = createToggleable(
              kind.charAt(0).toUpperCase() + kind.slice(1),
              true,
              "kind-label"
            );
            rootUl.appendChild(kindNode.li);

            // Ebene 3: Autoren
            const authors = listAuthors(cat, lang, kind);
            for (const a of authors) {
              const aNode = createToggleable(a.display, true, "author-label");
              kindNode.ul.appendChild(aNode.li);

              // Ebene 4: Werke
              const works = listWorks(cat, lang, kind, a.author);
              for (const w of works) {
                const workNode = createToggleable(w.title, true, "work-label");
                aNode.ul.appendChild(workNode.li);

                const url = `work.html?lang=${encodeURIComponent(
                  lang
                )}&kind=${encodeURIComponent(kind)}&author=${encodeURIComponent(
                  a.author
                )}&work=${encodeURIComponent(w.id)}`;
                const linkText =
                  "Originaltext + Birkenbihl" +
                  (w.versmass ? " (Versmaß-fähig)" : "");
                const workLeaf = createLeafLink(linkText, url);
                workNode.ul.appendChild(workLeaf);
              }
            }
          }
        }
      })();
    </script>
  </body>
</html>
